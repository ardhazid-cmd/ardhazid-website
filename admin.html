<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© â€” Ø£Ø±Ø¶Ù‡Ø§ Ø²ÙŠØ¯</title>
<meta name="theme-color" content="#2f5a2f"/>
<link rel="icon" href="favicon.ico" />
<style>
  :root{--green:#2f5a2f;--soft:#f6f6f2;--card:#fff}
  body{font-family: "Cairo", system-ui, Arial; background:var(--soft); margin:0; color:#222}
  .wrap{max-width:1100px;margin:18px auto;padding:12px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:8px;background:var(--green);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
  h1{margin:0;font-size:20px;color:var(--green)}
  .muted{color:#666;font-size:13px}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06);margin-top:14px}
  label{display:block;margin-top:10px;font-weight:700}
  input[type="text"], input[type="url"], input[type="number"], input[type="password"], textarea, select {
    width:100%;padding:9px;border-radius:8px;border:1px solid #e6e1d8;margin-top:6px;font-size:14px;box-sizing:border-box
  }
  textarea{min-height:80px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1 1 48%}
  button{background:var(--green);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn-muted{background:#777}
  .btn-danger{background:#b33}
  .list{margin-top:12px}
  .item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;background:#fafafa;margin-bottom:8px;border:1px solid #f0f0f0}
  .thumb{width:98px;height:70px;object-fit:cover;border-radius:8px;border:1px solid #eee}
  .actions{display:flex;gap:8px}
  .small{font-size:13px;color:#666}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tab{padding:8px 12px;border-radius:8px;background:#fff;cursor:pointer;border:1px solid #eee}
  .tab.active{background:var(--green);color:#fff}
  .flex-right{display:flex;gap:8px;align-items:center}
  @media(max-width:820px){ .col{flex:1 1 100%}}
</style>
</head>
<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="logo">AZ</div>
      <div>
        <h1>Ø£Ø±Ø¶Ù‡Ø§ Ø²ÙŠØ¯ â€” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
        <div class="muted small">ØªØ­ÙƒÙ‘Ù…ÙŠ Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„ØµÙˆØ±ØŒ ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª â€” ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ø¨Ø± ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ø­Ø¯Ø©</div>
      </div>
    </div>

    <div style="min-width:260px">
      <label>Token GitHub (Ù…Ø¤Ù‚Øª) â€” Ø£Ù„ØµÙ‚ÙŠÙ‡ Ù‡Ù†Ø§ ÙÙ‚Ø· ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸</label>
      <input id="ghToken" type="password" placeholder="Ø£Ù„ØµÙ‚ÙŠ Personal Access Token Ø¨ØµÙ„Ø§Ø­ÙŠØ© public_repo">
      <div style="margin-top:6px;display:flex;gap:8px;align-items:center">
        <button onclick="clearToken()" class="btn-muted">Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ†</button>
        <div class="muted small">Ù„Ø§ ØªØªØ±ÙƒÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ø§Ù„Ø­Ù‚Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡.</div>
      </div>
    </div>
  </header>

  <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
  <div class="card">
    <div class="tabs" id="mainTabs">
      <div class="tab active" data-tab="products">ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
      <div class="tab" data-tab="videos">ğŸ¥ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</div>
      <div class="tab" data-tab="media">ğŸ–¼ï¸ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</div>
      <div class="tab" data-tab="site">âš™ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <section id="tab-products" class="card">
    <h2>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div class="row">
      <div class="col">
        <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><input id="p_name_ar" type="text">
        <label>Ø§Ù„Ø§Ø³Ù… (FranÃ§ais)</label><input id="p_name_fr" type="text">
        <label>Ø§Ù„Ø§Ø³Ù… (English)</label><input id="p_name_en" type="text">
      </div>
      <div class="col">
        <label>Ø§Ù„ÙˆØµÙ (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><textarea id="p_desc_ar"></textarea>
        <label>Ø§Ù„ÙˆØµÙ (FranÃ§ais)</label><textarea id="p_desc_fr"></textarea>
        <label>Ø§Ù„ÙˆØµÙ (English)</label><textarea id="p_desc_en"></textarea>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯.Øª)</label><input id="p_price" type="text">
      </div>
      <div class="col">
        <label>Ø§Ù„ÙØ¦Ø©</label>
        <select id="p_category">
          <option value="bio">Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©</option>
          <option value="vegetal">Ù†Ø¨Ø§ØªÙŠØ©</option>
          <option value="animal">Ø­ÙŠÙˆØ§Ù†ÙŠØ©</option>
          <option value="maison">Ù…Ù†Ø²Ù„ÙŠØ©</option>
          <option value="grains">Ø­Ø¨ÙˆØ¨</option>
          <option value="normal">Ø¹Ø§Ø¯ÙŠØ©</option>
        </select>
      </div>
    </div>

    <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” Ø±ÙØ¹ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ)</label>
    <input id="p_file" type="file" accept="image/*">
    <div class="small muted" id="p_img_status">Ù„Ù… ØªÙØ±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯.</div>

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button onclick="addProductLocal()">â• Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠÙ‹Ø§</button>
      <button onclick="saveProductsToGitHub()">ğŸ’¾ Ø±ÙØ¹ ÙˆØ­ÙØ¸ products.json</button>
      <button onclick="resetProductForm()" class="btn-muted">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
    </div>

    <div class="list" id="productsList" style="margin-top:14px">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øªâ€¦</div>
  </section>

  <!-- VIDEOS -->
  <section id="tab-videos" class="card" style="display:none">
    <h2>ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h2>
    <div class="row">
      <div class="col">
        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><input id="v_title_ar" type="text">
        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (FranÃ§ais)</label><input id="v_title_fr" type="text">
        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (English)</label><input id="v_title_en" type="text">
      </div>
      <div class="col">
        <label>Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><textarea id="v_desc"></textarea>
        <label>Ø§Ø³Ù… Ø§Ù„ÙÙ„Ø§Ø­ / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label><input id="v_author" type="text">
      </div>
    </div>

    <label>Ø±Ø§Ø¨Ø· YouTube (Embed) Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input id="v_url" type="url" placeholder="https://www.youtube.com/embed/VIDEO_ID">
    <input id="v_file" type="file" accept="video/*">

    <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
      <button onclick="addVideoLocal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§</button>
      <button onclick="saveVideosToGitHub()">ğŸ’¾ Ø±ÙØ¹ ÙˆØ­ÙØ¸ videos.json</button>
      <button onclick="resetVideoForm()" class="btn-muted">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
    </div>

    <div class="list" id="videosList" style="margin-top:14px">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øªâ€¦</div>
  </section>

  <!-- MEDIA manager -->
  <section id="tab-media" class="card" style="display:none">
    <h2>ğŸ–¼ï¸ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (ØµÙˆØ± / ÙÙŠØ¯ÙŠÙˆØ§Øª Ù…Ø±ÙÙˆØ¹Ø©)</h2>
    <div class="muted small">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ÙŠÙ† <code>images/</code> Ùˆ <code>uploads/</code></div>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button onclick="listRepoFiles('images')">Ø¹Ø±Ø¶ ØµÙˆØ±</button>
      <button onclick="listRepoFiles('uploads')">Ø¹Ø±Ø¶ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª/Ù…Ù„ÙØ§Øª</button>
    </div>
    <div id="mediaList" style="margin-top:12px"></div>
  </section>

  <!-- tools -->
  <section id="tab-site" class="card" style="display:none">
    <h2>âš™ï¸ Ø£Ø¯ÙˆØ§Øª ÙˆÙ†Ø´Ø±</h2>
    <div class="row">
      <div class="col">
        <label>ØªØ¨Ø¯ÙŠÙ„ Ù„ØºØ© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
        <select id="previewLang"><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option><option value="fr">FranÃ§ais</option><option value="en">English</option></select>
      </div>
      <div class="col">
        <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…</label>
        <input type="text" value="https://ardhazid-cmd.github.io/ardhazid-website/" readonly>
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button onclick="loadAll()">â†» Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</button>
      <button onclick="openSite()" style="background:#4a90e2">ğŸ”— ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…</button>
      <button onclick="clearToken()" class="btn-muted">âœ– Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ†</button>
    </div>

    <div style="margin-top:12px" class="muted small">
      Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù…Ø§Ù†: Ù„Ø§ ØªØªØ±ÙƒÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ø¸Ø§Ù‡Ø±Ø§Ù‹ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„. Ø¶Ø¹ÙŠÙ‡ ÙÙ‚Ø· ÙˆÙ‚Øª Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø«Ù… Ø§Ù…Ø­ÙŠÙ‡.
    </div>
  </section>

</div>

<script>
/* ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±ÙŠØ¨Ùˆ ========== */
const REPO_OWNER = 'ardhazid-cmd';
const REPO_NAME = 'ardhazid-website';
const PRODUCTS_PATH = 'products.json';
const VIDEOS_PATH = 'videos.json';
const IMAGES_DIR = 'images';
const UPLOADS_DIR = 'uploads';

/* ========== Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ========== */
let productsData = [];
let videosData = { videos: [] };
let editingProductIndex = null;
let editingVideoIndex = null;

/* ========== Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ØµØºÙŠØ±Ø© ========== */
function getToken(){ return document.getElementById('ghToken').value.trim(); }
function clearToken(){ document.getElementById('ghToken').value=''; alert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ø­Ù‚Ù„'); }
function openSite(){ window.open(`https://${REPO_OWNER}.github.io/${REPO_NAME}/`, '_blank'); }
function show(msg){ alert(msg); }

/* ========== Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ========== */
document.getElementById('mainTabs').addEventListener('click', (e)=>{
  const t = e.target.closest('.tab'); if(!t) return;
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const key = t.dataset.tab;
  ['products','videos','media','site'].forEach(k=>{
    document.getElementById('tab-'+k).style.display = (k===key)?'block':'none';
  });
});

/* ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ (Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† raw.githubusercontent) ========== */
async function fetchJsonRaw(path){
  try{
    const res = await fetch(`https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${path}?`+Date.now());
    if(!res.ok) return null;
    return await res.json();
  }catch(e){ console.error(e); return null; }
}

async function loadAll(){
  // products
  let p = await fetchJsonRaw(PRODUCTS_PATH);
  if(!p) p = [];
  // normalize old forms
  if(p && p.products) p = p.products;
  productsData = Array.isArray(p)?p:[];

  // videos
  let v = await fetchJsonRaw(VIDEOS_PATH);
  if(!v) v = { videos: [] };
  if(Array.isArray(v)) v = { videos: v };
  videosData = v;

  renderProducts();
  renderVideos();
}
loadAll();

/* ========== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ========== */
function renderProducts(){
  const el = document.getElementById('productsList');
  if(!productsData || productsData.length===0){ el.innerHTML = '<div class="muted small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>'; return; }
  el.innerHTML = '';
  productsData.forEach((p, idx)=>{
    const item = document.createElement('div'); item.className='item';
    const img = p.image_url ? `<img src="${p.image_url}" class="thumb" alt="">` : `<div style="width:98px;height:70px;border-radius:8px;background:#f0f0f0;display:flex;align-items:center;justify-content:center;color:#999">ØµÙˆØ±Ø©</div>`;
    item.innerHTML = `
      ${img}
      <div style="flex:1">
        <div style="font-weight:800">${(p.name && p.name.ar) || p.name_ar || p.name || 'â€”'}</div>
        <div class="small muted">${p.category || ''} â€” ${p.price? p.price + ' Ø¯.Øª' : ''}</div>
      </div>
      <div class="actions">
        <button onclick="startEditProduct(${idx})" class="edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteProduct(${idx})" class="btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
      </div>
    `;
    el.appendChild(item);
  });
}

function renderVideos(){
  const el = document.getElementById('videosList');
  const arr = videosData.videos || [];
  if(!arr.length){ el.innerHTML = '<div class="muted small">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>'; return; }
  el.innerHTML = '';
  arr.forEach((v, idx)=>{
    const item = document.createElement('div'); item.className='item';
    item.innerHTML = `
      <div style="flex:1">
        <div style="font-weight:800">${(v.title && v.title.ar) || v.title_ar || v.title || 'â€”'}</div>
        <div class="small muted">${v.author || ''}</div>
      </div>
      <div class="actions">
        <button onclick="startEditVideo(${idx})" class="edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteVideo(${idx})" class="btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
      </div>
    `;
    el.appendChild(item);
  });
}

/* ========== Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ========== */
function resetProductForm(){
  ['p_name_ar','p_name_fr','p_name_en','p_desc_ar','p_desc_fr','p_desc_en','p_price'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('p_file').value = '';
  document.getElementById('p_img_status').innerText = 'Ù„Ù… ØªÙØ±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯.';
  editingProductIndex = null;
}

function addProductLocal(){
  const item = {
    id: 'p'+Date.now(),
    name: { ar: document.getElementById('p_name_ar').value.trim(), fr: document.getElementById('p_name_fr').value.trim(), en: document.getElementById('p_name_en').value.trim() },
    description: { ar: document.getElementById('p_desc_ar').value.trim(), fr: document.getElementById('p_desc_fr').value.trim(), en: document.getElementById('p_desc_en').value.trim() },
    price: document.getElementById('p_price').value.trim(),
    category: document.getElementById('p_category').value,
    image_url: ''
  };
  if(editingProductIndex !== null){
    productsData[editingProductIndex] = item;
    editingProductIndex = null;
  } else {
    productsData.unshift(item); // new on top
  }
  renderProducts();
  show('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­Ù„ÙŠÙ‹Ø§. Ø§Ø¶ØºØ·ÙŠ "Ø­ÙØ¸ products.json" Ù„Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');
}

/* ØªØ¹Ø¯ÙŠÙ„ */
function startEditProduct(i){
  const p = productsData[i];
  document.getElementById('p_name_ar').value = p.name?.ar || '';
  document.getElementById('p_name_fr').value = p.name?.fr || '';
  document.getElementById('p_name_en').value = p.name?.en || '';
  document.getElementById('p_desc_ar').value = p.description?.ar || '';
  document.getElementById('p_desc_fr').value = p.description?.fr || '';
  document.getElementById('p_desc_en').value = p.description?.en || '';
  document.getElementById('p_price').value = p.price || '';
  document.getElementById('p_category').value = p.category || '';
  editingProductIndex = i;
}

/* Ø­Ø°Ù */
function deleteProduct(i){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  productsData.splice(i,1);
  renderProducts();
}

/* ========== Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ù„ÙŠØ© Ù„Ù„ÙÙŠØ¯ÙŠÙˆ ========== */
function resetVideoForm(){
  ['v_title_ar','v_title_fr','v_title_en','v_desc','v_author','v_url'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('v_file').value = '';
  editingVideoIndex = null;
}

function addVideoLocal(){
  const item = {
    id: 'v'+Date.now(),
    title: { ar: document.getElementById('v_title_ar').value.trim(), fr: document.getElementById('v_title_fr').value.trim(), en: document.getElementById('v_title_en').value.trim() },
    description: document.getElementById('v_desc').value.trim(),
    url: document.getElementById('v_url').value.trim(),
    author: document.getElementById('v_author').value.trim()
  };
  if(editingVideoIndex !== null){
    videosData.videos[editingVideoIndex] = item;
    editingVideoIndex = null;
  } else {
    videosData.videos.unshift(item);
  }
  renderVideos();
  show('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§. Ø§Ø¶ØºØ·ÙŠ "Ø­ÙØ¸ videos.json" Ù„Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');
}

function startEditVideo(i){
  const v = videosData.videos[i];
  document.getElementById('v_title_ar').value = v.title?.ar || '';
  document.getElementById('v_title_fr').value = v.title?.fr || '';
  document.getElementById('v_title_en').value = v.title?.en || '';
  document.getElementById('v_desc').value = v.description || '';
  document.getElementById('v_url').value = v.url || '';
  document.getElementById('v_author').value = v.author || '';
  editingVideoIndex = i;
}
function deleteVideo(i){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) return;
  videosData.videos.splice(i,1);
  renderVideos();
}

/* ========== Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø±ÙŠØ¨Ùˆ ========== */
async function uploadFileToRepo(file, folder){
  const token = getToken();
  if(!token){ show('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù‚Ø¨Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù'); return null; }
  const safeName = Date.now() + '_' + file.name.replace(/\s+/g,'_');
  const path = `${folder}/${safeName}`;
  // read base64
  const b64 = await new Promise((res,rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result.split(',')[1]);
    r.onerror = ()=> rej('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
    r.readAsDataURL(file);
  });
  const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${encodeURIComponent(path)}`;
  const body = { message: `Upload ${safeName} via admin`, content: b64 };
  const resp = await fetch(url, {
    method: 'PUT',
    headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github.v3+json' },
    body: JSON.stringify(body)
  });
  if(!resp.ok){
    const e = await resp.json();
    console.error(e);
    show('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ' + (e.message || resp.statusText));
    return null;
  }
  return `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${folder}/${encodeURIComponent(safeName)}`;
}

/* ========== Ø­ÙØ¸ products.json (ÙŠØ±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ù† Ø§Ø®ØªÙŠØ±Øª) ========== */
async function saveProductsToGitHub(){
  const token = getToken();
  if(!token) return show('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸');
  // upload image if selected
  const fileInput = document.getElementById('p_file');
  if(fileInput.files && fileInput.files[0]){
    document.getElementById('p_img_status').innerText = 'Ø¬Ø§Ø±Ù Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...';
    const uploaded = await uploadFileToRepo(fileInput.files[0], IMAGES_DIR);
    if(uploaded){
      // assign to first product that has empty image_url (the most recent added)
      for(let i=0;i<productsData.length;i++){
        if(!productsData[i].image_url){ productsData[i].image_url = uploaded; break; }
      }
      document.getElementById('p_img_status').innerText = 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    } else {
      document.getElementById('p_img_status').innerText = 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    }
  }

  // prepare content
  const content = productsData;
  // get sha
  const sha = await getFileSha(PRODUCTS_PATH, token);
  // upload
  const putRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${PRODUCTS_PATH}`, {
    method: 'PUT',
    headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github.v3+json' },
    body: JSON.stringify({
      message: 'Update products.json via admin',
      content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
      sha
    })
  });
  if(!putRes.ok){
    const e = await putRes.json();
    console.error(e);
    return show('ÙØ´Ù„ Ø­ÙØ¸ products.json: ' + (e.message || putRes.statusText));
  }
  show('âœ… ØªÙ… Ø­ÙØ¸ products.json ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');
  // reload data
  await loadAll();
}

/* ========== Ø­ÙØ¸ videos.json (ÙŠØ±ÙØ¹ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù† Ø§Ø®ØªÙŠØ±) ========== */
async function saveVideosToGitHub(){
  const token = getToken();
  if(!token) return show('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸');
  const vfile = document.getElementById('v_file');
  if(vfile.files && vfile.files[0]){
    const uploaded = await uploadFileToRepo(vfile.files[0], UPLOADS_DIR);
    if(uploaded){
      // assign to first video without url
      for(let i=0;i<videosData.videos.length;i++){
        if(!videosData.videos[i].url){ videosData.videos[i].url = uploaded; break; }
      }
      show('ØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
    } else {
      show('ÙØ´Ù„ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
    }
  }
  const content = videosData;
  const sha = await getFileSha(VIDEOS_PATH, getToken());
  const putRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${VIDEOS_PATH}`, {
    method: 'PUT',
    headers: { Authorization: 'token ' + getToken(), Accept: 'application/vnd.github.v3+json' },
    body: JSON.stringify({
      message: 'Update videos.json via admin',
      content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
      sha
    })
  });
  if(!putRes.ok){ const e = await putRes.json(); console.error(e); return show('ÙØ´Ù„ Ø­ÙØ¸ videos.json'); }
  show('âœ… ØªÙ… Ø­ÙØ¸ videos.json ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');
  await loadAll();
}

/* ========== Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø¬Ù„Ø¨ SHA ========== */
async function getFileSha(path, token){
  try{
    const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`, {
      headers: token ? { Authorization: 'token ' + token } : {}
    });
    if(!res.ok){ const e = await res.json(); console.error(e); return null; }
    const data = await res.json();
    return data.sha;
  }catch(e){ console.error(e); return null; }
}

/* ========== Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ù…Ù„ÙØ§Øª Ø§Ù„Ø±ÙŠØ¨Ùˆ ÙÙŠ images/ Ø£Ùˆ uploads/ ========== */
async function listRepoFiles(folder){
  const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${folder}`;
  const res = await fetch(url);
  if(!res.ok){ document.getElementById('mediaList').innerText = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª.'; return; }
  const arr = await res.json();
  if(!arr.length){ document.getElementById('mediaList').innerText = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª.'; return; }
  const html = arr.map(a=>`
    <div style="display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:#fff;margin-bottom:8px">
      ${a.name.match(/\.(jpg|jpeg|png|gif)$/i) ? `<img src="${a.download_url}" style="width:110px;height:70px;object-fit:cover;border-radius:6px"/>` : '<div style="width:110px;height:70px;background:#eee;border-radius:6px;display:flex;align-items:center;justify-content:center">Ù…Ù„Ù</div>'}
      <div style="flex:1">
        <div style="font-weight:700">${a.name}</div>
        <div class="small muted">${a.size} Ø¨Ø§ÙŠØª</div>
      </div>
      <div style="display:flex;gap:8px">
        <a href="${a.download_url}" target="_blank"><button>ÙØªØ­</button></a>
      </div>
    </div>
  `).join('');
  document.getElementById('mediaList').innerHTML = html;
}

</script>
</body>
</html>
