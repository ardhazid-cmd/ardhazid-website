<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø³ÙŠØ·Ø© â€” Ardha Zid</title>
<style>
  body{font-family:system-ui, "Cairo",sans-serif;background:#f5f5f0;padding:14px;direction:rtl}
  .box{max-width:760px;margin:10px auto;background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  h2{margin:0 0 8px;color:#2f5a2f}
  label{display:block;margin-top:10px;font-weight:700}
  input,textarea,select,button{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e1d8;margin-top:6px;font-size:15px}
  button{background:#2f6b2f;color:#fff;border:none;padding:10px;cursor:pointer}
  .muted{color:#666;font-size:13px;margin-top:6px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .col{flex:1 1 48%}
  .item{padding:8px;border-radius:8px;background:#faf8f5;margin-top:8px;display:flex;align-items:center;gap:8px}
  .thumb{width:88px;height:60px;object-fit:cover;border-radius:6px;border:1px solid #eee}
  .smallbtn{padding:6px;font-size:13px;border-radius:6px}
  .danger{background:#b33}
</style>
</head>
<body>

<div class="box">
  <h2>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø³ÙŠØ·Ø© â€” Ardha Zid</h2>
  <div class="muted">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙŠØªØ·Ù„Ø¨ GitHub Personal Access Token Ø¨ØµÙ„Ø§Ø­ÙŠØ© <code>public_repo</code>. Ø£Ù„ØµÙ‚ÙŠÙ‡ Ù…Ø¤Ù‚ØªØ§Ù‹ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø£Ø¯Ù†Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø­ÙØ¸.</div>

  <label>GitHub Token (Ø¶Ø¹ÙÙ‡ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸)</label>
  <input id="ghToken" type="password" placeholder="Ø£Ù„ØµÙ‚ÙŠ ØªÙˆÙƒÙ† GitHub Ù‡Ù†Ø§ (public_repo)"/>

  <hr style="margin:12px 0"/>

  <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
  <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
  <div class="row">
    <div class="col">
      <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><input id="p_name_ar" />
      <label>Ø§Ù„Ø§Ø³Ù… (FranÃ§ais)</label><input id="p_name_fr" />
      <label>Ø§Ù„Ø§Ø³Ù… (English)</label><input id="p_name_en" />
    </div>
    <div class="col">
      <label>Ø§Ù„ÙˆØµÙ (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><textarea id="p_desc_ar" rows="3"></textarea>
      <label>Ø§Ù„ÙˆØµÙ (FranÃ§ais)</label><textarea id="p_desc_fr" rows="3"></textarea>
      <label>Ø§Ù„ÙˆØµÙ (English)</label><textarea id="p_desc_en" rows="3"></textarea>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>Ø§Ù„ÙØ¦Ø©</label>
      <select id="p_category">
        <option value="bio">Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©</option>
        <option value="plant">Ù…Ù†ØªØ¬Ø§Øª Ù†Ø¨Ø§ØªÙŠØ©</option>
        <option value="animal">Ù…Ù†ØªØ¬Ø§Øª Ø­ÙŠÙˆØ§Ù†ÙŠØ©</option>
        <option value="home">Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©</option>
        <option value="grains">Ø­Ø¨ÙˆØ¨</option>
        <option value="normal">Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø§Ø¯ÙŠØ©</option>
      </select>
    </div>
    <div class="col">
      <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯.Øª)</label><input id="p_price" type="text" />
    </div>
  </div>

  <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªØ± Ù…Ù„Ù)</label>
  <input id="p_image_file" type="file" accept="image/*" />
  <div class="muted small" id="p_img_status">Ù„Ù… ØªÙØ­Ù…Ù‘Ù„ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯</div>

  <div style="margin-top:10px">
    <button onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§</button>
    <button onclick="saveProductsToGitHub()" style="margin-top:8px">ğŸ’¾ Ø­ÙØ¸ products.json ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</button>
  </div>

  <div id="productsList" class="muted" style="margin-top:12px">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øªâ€¦</div>
</div>

<div class="box" style="margin-top:14px">
  <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª â€” Ù…Ù† Ù‚Ù„Ø¨ Ø§Ù„Ø£Ø±Ø¶</h3>
  <label>Ø¹Ù†ÙˆØ§Ù† (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><input id="v_title_ar" />
  <label>Ø¹Ù†ÙˆØ§Ù† (FranÃ§ais)</label><input id="v_title_fr" />
  <label>Ø¹Ù†ÙˆØ§Ù† (English)</label><input id="v_title_en" />
  <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube embed Ø£Ùˆ Drive preview)</label><input id="v_url" />
  <label>Ø§Ø³Ù… Ø§Ù„ÙÙ„Ø§Ø­ / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label><input id="v_author" />
  <div style="margin-top:10px">
    <button onclick="addVideo()">â• Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ù…Ø­Ù„ÙŠÙ‹Ø§</button>
    <button onclick="saveVideosToGitHub()" style="margin-top:8px">ğŸ’¾ Ø­ÙØ¸ videos.json</button>
  </div>
  <div id="videosList" class="muted" style="margin-top:12px">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øªâ€¦</div>
</div>

<div class="box" style="margin-top:14px">
  <button onclick="loadAll()">â†» Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</button>
  <div class="muted" style="margin-top:8px">Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† ÙÙ‚Ø· ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸. Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°ÙÙ‡ Ù…Ù† Ø§Ù„Ø­Ù‚Ù„.</div>
</div>

<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (ØºÙŠØ±ÙŠ Ø¥Ù† Ø§Ø­ØªØ¬Øª) */
const REPO_OWNER = 'ardhazid-cmd';
const REPO_NAME = 'ardhazid-website';
const PRODUCTS_PATH = 'products.json';
const VIDEOS_PATH = 'videos.json';
let productsData = [];
let videosData = { videos: [] };

/* Ù…Ø³Ø§Ø¹Ø¯Ø©: Ù‚Ø±Ø§Ø¡Ø© JSON Ù…Ù† raw.githubusercontent */
async function fetchJsonRaw(path){
  try{
    const url = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${path}?` + Date.now();
    const r = await fetch(url);
    if(!r.ok) return null;
    return await r.json();
  }catch(e){ console.error(e); return null; }
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
async function loadAll(){
  const pd = await fetchJsonRaw(PRODUCTS_PATH);
  productsData = Array.isArray(pd) ? pd : (pd && pd.products) ? pd.products : (pd || []);
  const vd = await fetchJsonRaw(VIDEOS_PATH);
  videosData = (vd && vd.videos) ? vd : (Array.isArray(vd) ? { videos: vd } : { videos: [] });

  renderProducts();
  renderVideos();
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
function renderProducts(){
  const el = document.getElementById('productsList');
  if(!productsData || productsData.length===0){ el.innerHTML = '<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>'; return; }
  el.innerHTML = '';
  productsData.forEach((p,i)=>{
    const div = document.createElement('div'); div.className='item';
    div.innerHTML = `
      ${p.image_url ? `<img src="${p.image_url}" class="thumb">` : ''}
      <div style="flex:1">
        <strong>${p.name?.ar || p.name_ar || p.name || 'â€”'}</strong>
        <div class="muted small">${p.category || ''} â€” ${p.price? p.price + ' Ø¯.Øª' : ''}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button class="smallbtn" onclick="startEdit(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="smallbtn danger" onclick="deleteProduct(${i})">Ø­Ø°Ù</button>
      </div>
    `;
    el.appendChild(div);
  });
}

/* Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª */
function renderVideos(){
  const el = document.getElementById('videosList');
  if(!videosData || !videosData.videos || videosData.videos.length===0){ el.innerHTML = '<div>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>'; return; }
  el.innerHTML = '';
  videosData.videos.forEach((v,i)=>{
    const div = document.createElement('div'); div.className='item';
    div.innerHTML = `
      <div style="flex:1">
        <strong>${v.title?.ar || v.title_ar || v.title || 'â€”'}</strong>
        <div class="muted small">${v.author || ''}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button class="smallbtn danger" onclick="deleteVideo(${i})">Ø­Ø°Ù</button>
      </div>
    `;
    el.appendChild(div);
  });
}

/* Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ø­Ù„ÙŠÙ‹Ø§ */
function addProduct(){
  const item = {
    id: 'p' + Date.now(),
    name: { ar: document.getElementById('p_name_ar').value.trim(), fr: document.getElementById('p_name_fr').value.trim(), en: document.getElementById('p_name_en').value.trim() },
    description: { ar: document.getElementById('p_desc_ar').value.trim(), fr: document.getElementById('p_desc_fr').value.trim(), en: document.getElementById('p_desc_en').value.trim() },
    category: document.getElementById('p_category').value,
    price: document.getElementById('p_price').value.trim(),
    image_url: ''
  };
  productsData.push(item);
  renderProducts();
  alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§. Ø§Ø¶ØºØ·ÙŠ "Ø­ÙØ¸ products.json" Ù„Ø¹Ù…Ù„ Commit ÙˆØ¯ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.');
}

/* Ø¨Ø¯Ø¡ ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ù…ÙŠÙ„ Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù†Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸) */
function startEdit(i){
  const p = productsData[i];
  document.getElementById('p_name_ar').value = p.name?.ar || '';
  document.getElementById('p_name_fr').value = p.name?.fr || '';
  document.getElementById('p_name_en').value = p.name?.en || '';
  document.getElementById('p_desc_ar').value = p.description?.ar || '';
  document.getElementById('p_desc_fr').value = p.description?.fr || '';
  document.getElementById('p_desc_en').value = p.description?.en || '';
  document.getElementById('p_category').value = p.category || '';
  document.getElementById('p_price').value = p.price || '';
  // remove old so save will re-add as new (simple flow)
  productsData.splice(i,1);
  renderProducts();
}

/* Ø­Ø°Ù Ù…Ù†ØªØ¬ */
function deleteProduct(i){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  productsData.splice(i,1);
  renderProducts();
}

/* Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ù…Ø­Ù„ÙŠÙ‹Ø§ */
function addVideo(){
  const item = {
    id: 'v' + Date.now(),
    title: { ar: document.getElementById('v_title_ar').value.trim(), fr: document.getElementById('v_title_fr').value.trim(), en: document.getElementById('v_title_en').value.trim() },
    url: document.getElementById('v_url').value.trim(),
    author: document.getElementById('v_author').value.trim()
  };
  videosData.videos.push(item);
  renderVideos();
  alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø­Ù„ÙŠÙ‹Ø§. Ø§Ø¶ØºØ·ÙŠ "Ø­ÙØ¸ videos.json" Ù„Ø¹Ù…Ù„ Commit.');
}

/* Ø­Ø°Ù ÙÙŠØ¯ÙŠÙˆ */
function deleteVideo(i){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) return;
  videosData.videos.splice(i,1);
  renderVideos();
}

/* --- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ repo/images --- */
async function uploadImageFileToRepo(file){
  const token = document.getElementById('ghToken').value.trim();
  if(!token){ alert('Ø£Ø¯Ø®Ù„ÙŠ GitHub token ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ'); return null; }
  const safeName = 'img_' + Date.now() + '_' + file.name.replace(/\s+/g,'_');
  const path = `images/${safeName}`;
  const b64 = await new Promise((res,rej)=>{
    const reader = new FileReader();
    reader.onload = ()=> res(reader.result.split(',')[1]);
    reader.onerror = ()=> rej('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
    reader.readAsDataURL(file);
  });
  const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${encodeURIComponent(path)}`;
  const body = { message: `Upload image ${safeName} via admin`, content: b64 };
  const resp = await fetch(url, {
    method: 'PUT',
    headers: { 'Authorization': 'token ' + token, 'Accept': 'application/vnd.github.v3+json' },
    body: JSON.stringify(body)
  });
  if(!resp.ok){ const e = await resp.json(); console.error(e); alert('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ' + (e.message || resp.statusText)); return null; }
  return `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/images/${encodeURIComponent(safeName)}`;
}

/* --- Ø­ÙØ¸ products.json (Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª) --- */
async function saveProductsToGitHub(){
  const token = document.getElementById('ghToken').value.trim();
  if(!token) return alert('Ø£Ø¯Ø®Ù„ÙŠ GitHub token Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª');

  // Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø©: Ø§Ø±ÙØ¹Ù‡ ÙˆØ§Ø¯Ù…Ø¬Ù‡ Ø¨Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£Ø®ÙŠØ± Ø§Ù„Ø°ÙŠ Ù„ÙŠØ³ Ù„Ù‡ ØµÙˆØ±Ø©
  const fileInput = document.getElementById('p_image_file');
  if(fileInput.files && fileInput.files[0]){
    document.getElementById('p_img_status').innerText = 'Ø¬Ø§Ø± Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...';
    const uploadedUrl = await uploadImageFileToRepo(fileInput.files[0]);
    if(uploadedUrl){
      // assign to last product without image
      for(let i=productsData.length-1;i>=0;i--){
        if(!productsData[i].image_url){ productsData[i].image_url = uploadedUrl; break; }
      }
      document.getElementById('p_img_status').innerText = 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    } else {
      document.getElementById('p_img_status').innerText = 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    }
  }

  // Ø¬Ù‡Ù‘Ø² Ø§Ù„Ù…Ø­ØªÙˆÙ‰
  const contentStr = JSON.stringify(productsData, null, 2);
  const contentB64 = btoa(unescape(encodeURIComponent(contentStr)));

  // Ø¬Ù„Ø¨ sha Ø¥Ù† ÙˆØ¬Ø¯
  const getUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${PRODUCTS_PATH}`;
  const g = await fetch(getUrl, { headers: { 'Authorization': 'token ' + token } });
  let sha = null;
  if(g.ok){ const gd = await g.json(); sha = gd.sha; }

  // Ø±ÙØ¹ (PUT)
  const putResp = await fetch(getUrl, {
    method: 'PUT',
    headers: { 'Authorization': 'token ' + token, 'Accept': 'application/vnd.github.v3+json' },
    body: JSON.stringify({ message: 'Update products.json via admin', content: contentB64, sha })
  });
  if(!putResp.ok){ const e = await putResp.json(); alert('ÙØ´Ù„ Ø­ÙØ¸ products.json: ' + (e.message || putResp.statusText)); console.error(e); return; }
  alert('âœ… ØªÙ… Ø­ÙØ¸ products.json Ø¨Ù†Ø¬Ø§Ø­.');
}

/* --- Ø­ÙØ¸ videos.json --- */
async function saveVideosToGitHub(){
  const token = document.getElementById('ghToken').value.trim();
  if(!token) return alert('Ø£Ø¯Ø®Ù„ÙŠ GitHub token Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª');
  const contentStr = JSON.stringify(videosData, null, 2);
  const contentB64 = btoa(unescape(encodeURIComponent(contentStr)));
  const getUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${VIDEOS_PATH}`;
  const g = await fetch(getUrl, { headers: { 'Authorization': 'token ' + token } });
  let sha = null;
  if(g.ok){ const gd = await g.json(); sha = gd.sha; }
  const putResp = await fetch(getUrl, {
    method: 'PUT',
    headers: { 'Authorization': 'token ' + token, 'Accept': 'application/vnd.github.v3+json' },
    body: JSON.stringify({ message: 'Update videos.json via admin', content: contentB64, sha })
  });
  if(!putResp.ok){ const e = await putResp.json(); alert('ÙØ´Ù„ Ø­ÙØ¸ videos.json: ' + (e.message || putResp.statusText)); console.error(e); return; }
  alert('âœ… ØªÙ… Ø­ÙØ¸ videos.json Ø¨Ù†Ø¬Ø§Ø­.');
}

/* init */
loadAll();
</script>

</body>
  </html>
