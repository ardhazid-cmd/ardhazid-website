<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø£Ø±Ø¶Ù‡Ø§ Ø²ÙŠØ¯</title>
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background-color: #f5f5f0;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #425d2f;
      text-align: center;
      margin-bottom: 30px;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: 0 auto;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background-color: #425d2f;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background-color: #5c7b40;
    }
  </style>
</head>
<body>

  <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø£Ø±Ø¶Ù‡Ø§ Ø²ÙŠØ¯ ğŸŒ¿</h1>

  <form id="productForm">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:</label>
    <input type="text" id="name_ar" required>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©:</label>
    <input type="text" id="name_fr" required>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:</label>
    <input type="text" id="name_en" required>

    <label>Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:</label>
    <textarea id="desc_ar" required></textarea>
    <label>Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©:</label>
    <textarea id="desc_fr" required></textarea>
    <label>Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:</label>
    <textarea id="desc_en" required></textarea>

    <label>Ø§Ù„Ø³Ø¹Ø±:</label>
    <input type="text" id="price" required>

    <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Image URL):</label>
    <input type="text" id="image">

    <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
    <select id="category">
      <option value="bio">Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©</option>
      <option value="vegetal">Ù…Ù†ØªØ¬Ø§Øª Ù†Ø¨Ø§ØªÙŠØ©</option>
      <option value="animal">Ù…Ù†ØªØ¬Ø§Øª Ø­ÙŠÙˆØ§Ù†ÙŠØ©</option>
      <option value="maison">Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©</option>
      <option value="autre">Ø£Ø®Ø±Ù‰</option>
    </select>

    <button type="button" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
  </form>

  <form id="videoForm">
    <h3>ğŸ¥ Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ</h3>
    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:</label>
    <input type="text" id="videoTitle" required>
    <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube Embed URL):</label>
    <input type="text" id="videoURL" required>
    <button type="button" onclick="addVideo()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
  </form>

  <script>
    async function addProduct() {
      alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ GitHub Ø³ÙŠØªÙØ¹Ù„ Ù„Ø§Ø­Ù‚Ù‹Ø§)");
    }

    async function addVideo() {
      alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ GitHub Ø³ÙŠØªÙØ¹Ù„ Ù„Ø§Ø­Ù‚Ù‹Ø§)");
    }
  </script>
<script>
  const GITHUB_TOKEN = "Ø¶Ø¹ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù‡Ù†Ø§ Ø¨ÙŠÙ† Ø¹Ù„Ø§Ù…ØªÙŠ Ø§Ù„ØªÙ†ØµÙŠØµ";
  const REPO_OWNER = "Ø¶Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ GitHub Ù‡Ù†Ø§";
  const REPO_NAME = "Ø¶Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù‡Ù†Ø§ (Ù†ÙØ³ Ø§Ù„Ù„ÙŠ ÙÙŠÙ‡ Ø§Ù„Ù…ÙˆÙ‚Ø¹)";
  const PRODUCTS_FILE = "products.json";
  const VIDEOS_FILE = "videos.json";

  // ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù JSON Ù…Ù† GitHub
  async function fetchFileContent(filePath) {
    const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`, {
      headers: { Authorization: `token ${GITHUB_TOKEN}` }
    });
    const data = await res.json();
    const content = atob(data.content);
    return { sha: data.sha, json: JSON.parse(content) };
  }

  // ğŸŸ¢ Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙŠ GitHub
  async function updateFile(filePath, newData, sha, message) {
    const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`, {
      method: "PUT",
      headers: {
        Authorization: `token ${GITHUB_TOKEN}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message,
        content: btoa(unescape(encodeURIComponent(JSON.stringify(newData, null, 2)))),
        sha
      })
    });
    return await res.json();
  }

  // ğŸŸ¢ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
  async function addProduct() {
    const name_ar = document.getElementById("name_ar").value;
    const name_fr = document.getElementById("name_fr").value;
    const name_en = document.getElementById("name_en").value;
    const desc_ar = document.getElementById("desc_ar").value;
    const desc_fr = document.getElementById("desc_fr").value;
    const desc_en = document.getElementById("desc_en").value;
    const price = document.getElementById("price").value;
    const image = document.getElementById("image").value;
    const category = document.getElementById("category").value;

    const { sha, json } = await fetchFileContent(PRODUCTS_FILE);

    json.push({
      name_ar, name_fr, name_en,
      desc_ar, desc_fr, desc_en,
      price, image, category
    });

    await updateFile(PRODUCTS_FILE, json, sha, "Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯");
    alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ GitHub!");
  }

  // ğŸŸ¢ Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯
  async function addVideo() {
    const title = document.getElementById("videoTitle").value;
    const url = document.getElementById("videoURL").value;

    const { sha, json } = await fetchFileContent(VIDEOS_FILE);

    json.push({ title, url });

    await updateFile(VIDEOS_FILE, json, sha, "Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯");
    alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ GitHub!");
  }
        </script>
<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© â€” Ø£Ø±Ø¶Ù‡Ø§ Ø²ÙŠØ¯</title>
<meta name="theme-color" content="#2f5a2f">
<style>
  :root{--green:#2f5a2f;--light:#f6f6f2;--card:#ffffff}
  body{font-family: 'Cairo',sans-serif;background:var(--light);margin:0;padding:18px;color:#222}
  .wrap{max-width:1000px;margin:0 auto}
  header{display:flex;align-items:center;gap:12px;justify-content:space-between}
  h1{margin:0;color:var(--green)}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06);margin-top:14px}
  label{display:block;margin-top:10px;font-weight:700}
  input[type="text"], input[type="url"], input[type="number"], textarea, select, input[type="password"]{
    width:100%;padding:9px;border-radius:8px;border:1px solid #e6e1d8;margin-top:6px;font-size:15px
  }
  textarea{min-height:70px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1 1 48%}
  button{background:var(--green);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn-danger{background:#b33}
  .muted{color:#666;font-size:13px}
  .list{margin-top:12px}
  .item{display:flex;gap:12px;align-items:center;padding:8px;border-radius:10px;background:#fbfbfb;margin-bottom:8px}
  .thumb{width:86px;height:64px;object-fit:cover;border-radius:8px;border:1px solid #eee}
  .actions{display:flex;gap:8px}
  .small{font-size:13px}
  @media(max-width:700px){ .col{flex:1 1 100%} header{flex-direction:column;align-items:flex-start;gap:6px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Ø£Ø±Ø¶Ù‡Ø§ Ø²ÙŠØ¯ â€” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
      <div class="muted small">Ø£Ø¯ÙŠØ±ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªØŒ ÙˆØ§Ù„Ù„ØºØ§Øª Ù…Ù† Ù‡Ù†Ø§.</div>
    </div>
    <div style="min-width:220px">
      <label>GitHub Token (Ù…Ø¤Ù‚Øª)</label>
      <input id="ghToken" type="password" placeholder="Ø£Ù„ØµÙ‚ÙŠ ØªÙˆÙƒÙ† GitHub Ù‡Ù†Ø§ (public_repo)" />
      <div class="muted small">Ø£Ø¯Ø®Ù„ÙŠÙ‡ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­ÙØ¸ØŒ Ø«Ù… Ø§Ø­Ø°ÙÙŠÙ‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡.</div>
    </div>
  </header>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <section class="card" id="productsCard">
    <h2>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>

    <div class="row">
      <div class="col">
        <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><input id="p_name_ar" type="text">
        <label>Ø§Ù„Ø§Ø³Ù… (FranÃ§ais)</label><input id="p_name_fr" type="text">
        <label>Ø§Ù„Ø§Ø³Ù… (English)</label><input id="p_name_en" type="text">
      </div>
      <div class="col">
        <label>Ø§Ù„ÙˆØµÙ (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><textarea id="p_desc_ar"></textarea>
        <label>Ø§Ù„ÙˆØµÙ (FranÃ§ais)</label><textarea id="p_desc_fr"></textarea>
        <label>Ø§Ù„ÙˆØµÙ (English)</label><textarea id="p_desc_en"></textarea>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯.Øª)</label><input id="p_price" type="text">
      </div>
      <div class="col">
        <label>Ø§Ù„ÙØ¦Ø©</label>
        <select id="p_category">
          <option value="bio">Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙŠÙˆÙ„ÙˆØ¬ÙŠØ©</option>
          <option value="vegetal">Ù†Ø¨Ø§ØªÙŠØ©</option>
          <option value="animal">Ø­ÙŠÙˆØ§Ù†ÙŠØ©</option>
          <option value="maison">Ù…Ù†Ø²Ù„ÙŠØ©</option>
          <option value="grains">Ø­Ø¨ÙˆØ¨</option>
          <option value="normal">Ø¹Ø§Ø¯ÙŠØ©</option>
        </select>
      </div>
    </div>

    <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Ø±ÙØ¹ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ)</label>
    <input id="p_file" type="file" accept="image/*">
    <div class="muted small" id="p_img_status">Ù„Ù… ØªÙØ±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯.</div>

    <div style="margin-top:10px;display:flex;gap:8px">
      <button onclick="addProductLocal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§</button>
      <button onclick="saveProductsToGitHub()">ğŸ’¾ Ø±ÙØ¹ ÙˆØ­ÙØ¸ products.json</button>
      <button onclick="clearProductForm()" style="background:#777">Ø¥ÙØ±Ø§Øº Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
    </div>

    <div class="list" id="productsList">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øªâ€¦</div>
  </section>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
  <section class="card" id="videosCard">
    <h2>ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h2>
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</label><input id="v_title_ar" type="text">
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (FranÃ§ais)</label><input id="v_title_fr" type="text">
    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (English)</label><input id="v_title_en" type="text">
    <label>Ø±Ø§Ø¨Ø· YT (embed) Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ</label>
    <input id="v_url" type="url" placeholder="https://www.youtube.com/embed/..." />
    <input id="v_file" type="file" accept="video/*" />
    <label>Ø§Ø³Ù… Ø§Ù„ÙÙ„Ø§Ø­ / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label><input id="v_author" type="text">

    <div style="margin-top:10px;display:flex;gap:8px">
      <button onclick="addVideoLocal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§</button>
      <button onclick="saveVideosToGitHub()">ğŸ’¾ Ø±ÙØ¹ ÙˆØ­ÙØ¸ videos.json</button>
    </div>

    <div class="list" id="videosList">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øªâ€¦</div>
  </section>

  <!-- Ø£Ø¯ÙˆØ§Øª -->
  <section class="card">
    <h3>âš™ï¸ Ø£Ø¯ÙˆØ§Øª</h3>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button onclick="loadAll()">â†» Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</button>
      <button onclick="openSite()" style="background:#4a90e2">Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø§Ù…</button>
      <button onclick="logoutToken()" style="background:#aaa">âœ– Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ†</button>
    </div>
    <div class="muted small" style="margin-top:8px">
      Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ­Ù…ÙŠÙ„/Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆ) ÙŠØªØ·Ù„Ø¨ ØªÙˆÙƒÙ† ØµØ§Ù„Ø­ Ø¨ØµÙ„Ø§Ø­ÙŠØ© <code>public_repo</code>.
    </div>
  </section>

</div>

<script>
/* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Ø«Ø§Ø¨ØªØ©) ===== */
const REPO_OWNER = 'ardhazid-cmd';
const REPO_NAME = 'ardhazid-website';
const PRODUCTS_PATH = 'products.json';
const VIDEOS_PATH = 'videos.json';
const IMAGES_DIR = 'images';
const UPLOADS_DIR = 'uploads';

/* ===== Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ¶Ø¹ÙŠØ© ===== */
let productsData = [];
let videosData = { videos: [] };

/* ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ===== */
function getToken(){ return document.getElementById('ghToken').value.trim(); }
function showMsg(msg){ alert(msg); }
function openSite(){ window.open(`https://${REPO_OWNER}.github.io/${REPO_NAME}/`, '_blank'); }
function logoutToken(){ document.getElementById('ghToken').value=''; showMsg('ØªÙ… Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ø­Ù‚Ù„'); }

/* ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙŠØ§Øª JSON Ù…Ù† raw (Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©) */
async function fetchJsonRaw(path){
  try{
    const res = await fetch(`https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${path}?`+Date.now());
    if(!res.ok) return null;
    return await res.json();
  }catch(e){ console.error(e); return null; }
}

/* Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ SHA Ù„Ù…Ù„Ù (Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¹Ù…Ù„ÙŠØ© PUT) */
async function getFileSha(path, token){
  const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`, {
    headers: token ? { Authorization: 'token ' + token } : {}
  });
  if(!res.ok) return null;
  const data = await res.json();
  return data.sha;
}

/* ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§ */
async function loadAll(){
  productsData = await fetchJsonRaw(PRODUCTS_PATH) || [];
  // normalize if object
  if(productsData && productsData.products) productsData = productsData.products || [];
  videosData = await fetchJsonRaw(VIDEOS_PATH) || { videos: [] };
  if(!videosData.videos && Array.isArray(videosData)) videosData = { videos: videosData };
  renderProducts();
  renderVideos();
}
loadAll();

/* ===== Ø¹Ø±Ø¶ ===== */
function renderProducts(){
  const el = document.getElementById('productsList');
  if(!productsData || productsData.length===0){ el.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª.</div>'; return; }
  el.innerHTML = '';
  productsData.forEach((p, idx) => {
    const div = document.createElement('div'); div.className='item';
    const img = p.image_url ? `<img src="${p.image_url}" class="thumb" alt="">` : `<div style="width:86px;height:64px;border-radius:8px;background:#f0f0f0;display:flex;align-items:center;justify-content:center;color:#999">ØµÙˆØ±Ø©</div>`;
    div.innerHTML = `
      ${img}
      <div style="flex:1">
        <div style="font-weight:800">${(p.name?.ar)||p.name_ar||p.name||'â€”'}</div>
        <div class="muted small">${p.category || ''} â€” ${p.price? p.price + ' Ø¯.Øª' : ''}</div>
      </div>
      <div class="actions">
        <button onclick="startEditProduct(${idx})" class="edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteProduct(${idx})" class="btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
      </div>
    `;
    el.appendChild(div);
  });
}

function renderVideos(){
  const el = document.getElementById('videosList');
  const arr = videosData.videos || [];
  if(!arr.length){ el.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª.</div>'; return; }
  el.innerHTML = '';
  arr.forEach((v, idx) => {
    const div = document.createElement('div'); div.className='item';
    div.innerHTML = `
      <div style="flex:1">
        <div style="font-weight:800">${(v.title?.ar)||v.title_ar||v.title||'â€”'}</div>
        <div class="muted small">${v.author || ''}</div>
      </div>
      <div class="actions">
        <button onclick="startEditVideo(${idx})" class="edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="deleteVideo(${idx})" class="btn-danger">ğŸ—‘ Ø­Ø°Ù</button>
      </div>
    `;
    el.appendChild(div);
  });
}

/* ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ ===== */
function clearProductForm(){
  ['p_name_ar','p_name_fr','p_name_en','p_desc_ar','p_desc_fr','p_desc_en','p_price','p_category'].forEach(id=>document.getElementById(id)?.value='');
  document.getElementById('p_file').value = '';
  document.getElementById('p_img_status').innerText = 'Ù„Ù… ØªÙØ±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯.';
  editingProductIndex = null;
}

let editingProductIndex = null;
function addProductLocal(){
  const item = {
    id: 'p' + Date.now(),
    name: { ar: document.getElementById('p_name_ar').value.trim(), fr: document.getElementById('p_name_fr').value.trim(), en: document.getElementById('p_name_en').value.trim() },
    description: { ar: document.getElementById('p_desc_ar').value.trim(), fr: document.getElementById('p_desc_fr').value.trim(), en: document.getElementById('p_desc_en').value.trim() },
    price: document.getElementById('p_price').value.trim(),
    category: document.getElementById('p_category').value,
    image_url: '' // set after upload when saving
  };
  if(editingProductIndex !== null){
    productsData[editingProductIndex] = item;
    editingProductIndex = null;
  } else {
    productsData.push(item);
  }
  renderProducts();
  showMsg('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­Ù„ÙŠÙ‹Ø§. Ø§Ø¶ØºØ·ÙŠ "Ø­ÙØ¸ products.json" Ù„ÙƒÙŠ ØªØ­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ GitHub.');
}

/* ØªØ¹Ø¯ÙŠÙ„ Ù…Ø­Ù„ÙŠ: ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø³ÙŠØ¹Ø§Ø¯ Ø­ÙØ¸Ù‡ ÙƒØ¬Ø¯ÙŠØ¯) */
function startEditProduct(i){
  const p = productsData[i];
  document.getElementById('p_name_ar').value = p.name?.ar || '';
  document.getElementById('p_name_fr').value = p.name?.fr || '';
  document.getElementById('p_name_en').value = p.name?.en || '';
  document.getElementById('p_desc_ar').value = p.description?.ar || '';
  document.getElementById('p_desc_fr').value = p.description?.fr || '';
  document.getElementById('p_desc_en').value = p.description?.en || '';
  document.getElementById('p_price').value = p.price || '';
  document.getElementById('p_category').value = p.category || '';
  editingProductIndex = i;
}

/* Ø­Ø°Ù Ù…Ù†ØªØ¬ Ù…Ø­Ù„ÙŠ */
function deleteProduct(i){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  productsData.splice(i,1);
  renderProducts();
}

/* ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ ===== */
let editingVideoIndex = null;
function addVideoLocal(){
  const item = {
    id: 'v' + Date.now(),
    title: { ar: document.getElementById('v_title_ar').value.trim(), fr: document.getElementById('v_title_fr').value.trim(), en: document.getElementById('v_title_en').value.trim() },
    url: document.getElementById('v_url').value.trim(),
    author: document.getElementById('v_author').value.trim()
  };
  if(editingVideoIndex !== null){
    videosData.videos[editingVideoIndex] = item;
    editingVideoIndex = null;
  } else {
    videosData.videos.push(item);
  }
  renderVideos();
  showMsg('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø­Ù„ÙŠÙ‹Ø§. Ø§Ø¶ØºØ·ÙŠ "Ø­ÙØ¸ videos.json" Ù„Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ GitHub.');
}
function startEditVideo(i){
  const v = videosData.videos[i];
  document.getElementById('v_title_ar').value = v.title?.ar || '';
  document.getElementById('v_title_fr').value = v.title?.fr || '';
  document.getElementById('v_title_en').value = v.title?.en || '';
  document.getElementById('v_url').value = v.url || '';
  document.getElementById('v_author').value = v.author || '';
  editingVideoIndex = i;
}
function deleteVideo(i){
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ')) return;
  videosData.videos.splice(i,1);
  renderVideos();
}

/* ===== Ø±ÙØ¹ Ù…Ù„Ù Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (ØµÙˆØ± Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ) ===== */
async function uploadFileToRepo(file, destFolder){
  const token = getToken();
  if(!token){ showMsg('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù‚Ø¨Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù'); return null; }
  const safeName = Date.now() + '_' + file.name.replace(/\s+/g,'_');
  const path = `${destFolder}/${safeName}`;
  // read as data URL and take base64 part
  const b64 = await new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = ()=> resolve(reader.result.split(',')[1]);
    reader.onerror = ()=> reject('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
    reader.readAsDataURL(file);
  });
  const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${encodeURIComponent(path)}`;
  const body = { message: `Upload ${safeName} via admin`, content: b64 };
  const res = await fetch(url, {
    method: 'PUT',
    headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github.v3+json' },
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const err = await res.json();
    console.error(err);
    showMsg('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ' + (err.message || res.statusText));
    return null;
  }
  // direct raw URL
  return `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${destFolder}/${encodeURIComponent(safeName)}`;
}

/* ===== Ø­ÙØ¸ products.json (Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù† Ø§Ø®ØªÙŠØ±Øª) ===== */
async function saveProductsToGitHub(){
  const token = getToken();
  if(!token) return showMsg('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸');
  const fileInput = document.getElementById('p_file');
  if(fileInput.files && fileInput.files[0]){
    document.getElementById('p_img_status').innerText = 'Ø¬Ø§Ø±Ù Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...';
    const uploaded = await uploadFileToRepo(fileInput.files[0], IMAGES_DIR);
    if(uploaded){
      // assign to last product without image_url
      for(let i = productsData.length-1; i>=0; i--){
        if(!productsData[i].image_url){ productsData[i].image_url = uploaded; break; }
      }
      document.getElementById('p_img_status').innerText = 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    } else {
      document.getElementById('p_img_status').innerText = 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©';
    }
  }

  // prepare content (ensure array)
  const content = productsData || [];
  // get sha
  const sha = await getFileSha(PRODUCTS_PATH, token);
  // upload
  const putRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${PRODUCTS_PATH}`, {
    method: 'PUT',
    headers: { Authorization: 'token ' + token, Accept: 'application/vnd.github.v3+json' },
    body: JSON.stringify({
      message: 'Update products.json via admin',
      content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
      sha
    })
  });
  if(!putRes.ok){
    const e = await putRes.json();
    console.error(e);
    return showMsg('ÙØ´Ù„ Ø­ÙØ¸ products.json: ' + (e.message || putRes.statusText));
  }
  showMsg('âœ… ØªÙ… Ø­ÙØ¸ products.json ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');
  // reload to reflect
  await loadAll();
}

/* ===== Ø­ÙØ¸ videos.json (Ù…Ø¹ Ø±ÙØ¹ Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ Ø¥Ù† Ø§Ø®ØªÙŠØ±) ===== */
async function saveVideosToGitHub(){
  const token = getToken();
  if(!token) return showMsg('Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„ØªÙˆÙƒÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸');
  const vfile = document.getElementById('v_file');
  if(vfile.files && vfile.files[0]){
    const uploaded = await uploadFileToRepo(vfile.files[0], UPLOADS_DIR);
    if(uploaded){
      // assign url to last video without url
      for(let i = videosData.videos.length-1;i>=0;i--){
        if(!videosData.videos[i].url){ videosData.videos[i].url = uploaded; break; }
      }
      showMsg('ØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
    } else {
      showMsg('ÙØ´Ù„ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
    }
  }
  const content = videosData || { videos: [] };
  const sha = await getFileSha(VIDEOS_PATH, getToken());
  const putRes = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${VIDEOS_PATH}`, {
    method: 'PUT',
    headers: { Authorization: 'token ' + getToken(), Accept: 'application/vnd.github.v3+json' },
    body: JSON.stringify({
      message: 'Update videos.json via admin',
      content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
      sha
    })
  });
  if(!putRes.ok){ const e = await putRes.json(); console.error(e); return showMsg('ÙØ´Ù„ Ø­ÙØ¸ videos.json'); }
  showMsg('âœ… ØªÙ… Ø­ÙØ¸ videos.json ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');
  await loadAll();
}

</script>
</body>
</html>
</body>
</html>
